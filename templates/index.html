<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>DrunkTyper</title>
    <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
</head>
<body>
    <h2>DrunkTyper by koleq (c) 2023</h2>
    <p><a href="/settings">settings</a></p>
    <p id="text1">{{ text }}</p>
    <textarea rows="1" id="user-input"></textarea>
    <p id="took1">finish a test to get a time</p>
    <p><a href=".">restart</a></p>
    <p>rWPM = Real WPM (words / time) / 60<br>aWPM = Average American Word WPM ((characters / 5) / time) * 60</p>
    <p>Made using Python 3.11.5 - Flask 2.3.3, HTML 5, JavaScript - jQuery 3.7.0, CSS 3</p>
    <h4>Debug:</h4>
    <p id="debug"></p>
    
    <script>
        var input = $("#user-input");
        var last_correct = ""

        $(document).ready(function(){
            $.fn.index_communicate();
        })

        input.keyup(function() {
            $.fn.index_communicate();
        })

        $.fn.index_communicate = function(){
            var debug = $("#debug")
            var text1 = $("#text1")
            var took1 = $("#took1")

            var value = input.val();
            
            $.ajax({
                url: "/index_input",
                type: "POST",
                data: value,
                contentType: "text/plain",
                success: function(response) {
                    //console.log(response);
                    input.attr('rows', response.rows)
                    debug.text(`${response.number} ${response.status} ${response.stopat} ${response.rows}`)
                    text1.html(response.text)
                    took1.text(response.took)
                    if (response.stopat == "letter"){
                        if (response.status == "False"){
                            input.val(value.slice(0,-1))
                        }
                    }
                    
                },
                error: function(error) {
                    console.error(error);
                }
            });
        };
    </script>

    <style>
        p {
            font: 16px "consolas";
        }

        textarea {
            font: 16px "consolas";

            resize: none;

            -webkit-box-sizing: border-box;
            -moz-box-sizing: border-box;
            box-sizing: border-box;

            width: 100%;
        }

        #correct {
            color: lime;
        }

        #wrong {
            color: red;
        }
    </style>
</body>
</html>
